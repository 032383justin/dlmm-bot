# DLMM Rotation Bot

A high-performance, production-ready TypeScript bot for rotating liquidity in Solana DLMM pools.

## Features

- **Elite Filters**: Age, TVL, Volume Velocity, Bin Tightness, Holder Distribution.
- **Dilution Detection**: Real-time RPC checks for token supply and holder concentration.
- **Volume Momentum**: Enters only on increasing velocity and volume spikes.
- **Weighted Scoring**: Dynamic scoring model based on velocity, stability, efficiency, and risk.
- **Rotation Engine**: Automatically rotates capital into top-performing pools.
- **Persistence**: Logs all actions and snapshots to Supabase.

## Prerequisites

- Node.js v20+
- Supabase Project
- Helius RPC URL

## Installation

1. Clone the repository.
2. Install dependencies:
   ```bash
   npm install
   ```
3. Configure environment variables:
   Copy `.env.example` to `.env` and fill in your details:
   ```env
   RPC_URL=https://mainnet.helius-rpc.com/?api-key=...
   SUPABASE_URL=https://your-project.supabase.co
   SUPABASE_KEY=your-anon-key
   ENV=prod
   ```

## Database Setup

Create the following tables in Supabase:

```sql
create table bot_logs (
  id bigint generated by default as identity primary key,
  action text,
  details jsonb,
  timestamp timestamptz
);

create table pool_snapshots (
  id bigint generated by default as identity primary key,
  pool_address text,
  data jsonb,
  timestamp timestamptz
);

create table active_positions (
  pool_address text primary key,
  entry_time bigint,
  entry_score numeric,
  amount numeric
);
```

## Running the Bot

### Development
```bash
npx ts-node src/index.ts
```

### Production (PM2)
1. Build the project:
   ```bash
   npm run build
   ```
   (Add `"build": "tsc"` to package.json scripts if missing)

2. Start with PM2:
   ```bash
   pm2 start pm2.config.cjs
   ```

## Architecture

- `src/core`: Core logic for scanning, normalizing, and filtering.
- `src/scoring`: Weighted scoring model.
- `src/utils`: Helpers for math and logging.
- `src/db`: Supabase integration.
- `src/index.ts`: Main orchestration loop.
